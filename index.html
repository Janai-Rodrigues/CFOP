<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Rápida de CFOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Scrollbar customizada para o tema claro */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-400 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
    <div class="p-4 sm:p-6 lg:p-8 min-h-screen relative">

        <a href="https://blog.cefis.com.br/tabela-cfop/" target="_blank" rel="noopener noreferrer" class="absolute top-4 right-4 bg-white border border-gray-300 text-gray-700 text-sm font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 flex items-center gap-2">
            <span>Tabela Oficial</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right-from-square"><path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"/><path d="m21 3-9 9"/><path d="M15 3h6v6"/></svg>
        </a>

        <header class="text-center mb-8 max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Consulta Rápida de CFOP</h1>
            <p class="text-lg text-gray-600 mt-2">Encontre e filtre Códigos Fiscais de Operações e Prestações facilmente.</p>
        </header>

        <!-- Filtros -->
        <div class="flex flex-col md:flex-row gap-4 mb-8 sticky top-4 z-10 bg-gray-100/80 backdrop-blur-sm p-4 rounded-lg shadow-sm border border-gray-200 max-w-7xl mx-auto">
            <div class="relative flex-grow">
                <input type="text" id="searchInput" placeholder="Pesquisar por código (com ou sem ponto) ou descrição..." class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-shadow">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
            </div>
            <select id="categoryFilter" class="p-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition-shadow md:w-1/4">
                <option value="">Todas as Categorias</option>
            </select>
        </div>
        
        <!-- Loading Spinner -->
        <div id="loading" class="text-center py-10">
             <div class="flex justify-center items-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
             </div>
             <p class="mt-4 text-gray-600">Carregando CFOPs...</p>
        </div>


        <!-- Grid de CFOPs -->
        <div id="cfopGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-7xl mx-auto">
            <!-- Os cards de CFOP serão inseridos aqui -->
        </div>
        
        <!-- Mensagem de "Nenhum resultado" -->
        <div id="noResults" class="text-center py-10 hidden">
             <p class="text-xl text-gray-500">Nenhum resultado encontrado.</p>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="cfopModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div id="modalContent" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <div>
                    <h2 id="modalCode" class="text-3xl font-bold text-gray-900"></h2>
                    <span id="modalType" class="text-sm font-semibold px-3 py-1 rounded-full mt-2 inline-block"></span>
                </div>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Descrição</h3>
                <p id="modalDescription" class="text-gray-700 mb-6"></p>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Aplicação</h3>
                <p id="modalApplication" class="text-gray-600"></p>
            </div>
            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-200 bg-gray-50 rounded-b-2xl">
                <p class="text-sm text-gray-600"><strong>Categoria:</strong> <span id="modalCategory"></span></p>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Element Selection ---
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const cfopGrid = document.getElementById('cfopGrid');
            const noResults = document.getElementById('noResults');
            const loading = document.getElementById('loading');
            const cfopModal = document.getElementById('cfopModal');
            const modalContent = document.getElementById('modalContent');
            const closeModalBtn = document.getElementById('closeModalBtn');

            // --- Modal Data Elements ---
            const modalCode = document.getElementById('modalCode');
            const modalType = document.getElementById('modalType');
            const modalDescription = document.getElementById('modalDescription');
            const modalApplication = document.getElementById('modalApplication');
            const modalCategory = document.getElementById('modalCategory');

            let cfops = [];
            let searchTimeout;

            // --- Fetching and Initializing Data ---
            fetch('cfops.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    loading.classList.add('hidden');
                    cfops = data;
                    populateCategories(cfops);
                    renderCfops(cfops);
                })
                .catch(error => {
                    loading.innerHTML = `<p class="text-red-500">Erro ao carregar os dados. Por favor, tente recarregar a página.</p><p class="text-sm text-gray-500 mt-2">${error}</p>`;
                    console.error("Fetch Error:", error);
                });

            // --- Helper Functions ---
            const populateCategories = (data) => {
                const categories = [...new Set(data.map(item => item.category))];
                categories.sort();
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            };

            const highlightMatches = (text, searchTerm) => {
                if (!searchTerm || searchTerm.trim() === '') return text;
                const escapedTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(escapedTerm, 'gi');
                return text.replace(regex, match => `<mark class="bg-teal-200 text-teal-900 rounded px-1 py-0.5 not-italic font-semibold">${match}</mark>`);
            };

            const renderCfops = (data, searchTerm = '') => {
                cfopGrid.innerHTML = '';
                if (data.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    noResults.classList.add('hidden');
                }
                data.forEach(cfop => {
                    const card = document.createElement('div');
                    card.className = `bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-blue-500`;
                    
                    const typeColor = cfop.type === 'Entrada' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';

                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">${highlightMatches(cfop.code, searchTerm)}</h2>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${typeColor}">${cfop.type}</span>
                        </div>
                        <p class="text-sm font-semibold text-gray-700 mb-2">${highlightMatches(cfop.description, searchTerm)}</p>
                        <p class="text-gray-600 text-xs flex-grow italic">${highlightMatches(cfop.application, searchTerm)}</p>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                           <p class="text-xs text-gray-500"><strong>Categoria:</strong> ${cfop.category}</p>
                        </div>
                    `;
                    card.addEventListener('click', () => openModal(cfop));
                    cfopGrid.appendChild(card);
                });
            };

            const filterAndRender = () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const selectedCategory = categoryFilter.value;
                const searchTermNoDot = searchTerm.replace(/\./g, '');

                const filteredCfops = cfops.filter(cfop => {
                    const codeNoDot = cfop.code.replace(/\./g, '');
                    
                    const matchesSearch = !searchTerm || 
                        codeNoDot.includes(searchTermNoDot) || 
                        cfop.description.toLowerCase().includes(searchTerm) || 
                        cfop.application.toLowerCase().includes(searchTerm);

                    const matchesCategory = !selectedCategory || cfop.category === selectedCategory;
                    
                    return matchesSearch && matchesCategory;
                });
                renderCfops(filteredCfops, searchTerm);
            };

            // --- Modal Functions ---
            const openModal = (cfop) => {
                modalCode.textContent = cfop.code;
                modalDescription.textContent = cfop.description;
                modalApplication.textContent = cfop.application;
                modalCategory.textContent = cfop.category;
                modalType.textContent = cfop.type;
                
                const typeColor = cfop.type === 'Entrada' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';
                modalType.className = `text-sm font-semibold px-3 py-1 rounded-full mt-2 inline-block ${typeColor}`;

                cfopModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10); 
            };
            
            const closeModal = () => {
                modalContent.classList.add('scale-95', 'opacity-0');
                modalContent.classList.remove('scale-100', 'opacity-100');
                
                setTimeout(() => {
                    cfopModal.classList.add('hidden');
                    document.body.style.overflow = ''; 
                }, 300); // Match duration-300
            };

            // --- Event Listeners ---
            searchInput.addEventListener('keyup', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(filterAndRender, 300);
            });

            categoryFilter.addEventListener('change', filterAndRender);
            
            closeModalBtn.addEventListener('click', closeModal);

            cfopModal.addEventListener('click', (e) => {
                if (e.target === cfopModal) { // Click on overlay
                    closeModal();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !cfopModal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>


